box: node:5.9
services:
    - mongo
    - redis
build:
  steps:
    - npm-install
    - script:
        name: env
        code: env
    - script:
        name: npm run build
        code: npm run build
    - script:
        name: npm start
        code: |
          export WU_REDIS_HOST=$REDIS_PORT_6379_TCP_ADDR
          export WU_MONGO_HOST=$MONGO_PORT_27017_TCP_ADDR
          npm start
    - script:
        name: npm show logs
        code: tail -n 50 /root/.pm2/logs/api-error-0.log
    - script:
        name: npm run pm-show
        code: npm run pm-show
    - script:
        name: npm run mocha
        code: npm run mocha
    - script:
        name: npm stop
        code: npm stop
